<!DOCTYPE html>
<html lang="pt-br">
<meta charset="UTF-8">
<title>Grid</title>
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
<script src="dist/js/villa.min.js"></script>
<link rel="stylesheet" href="dist/css/villa.min.css"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link type="text/css" rel="stylesheet" href="dist/css/materialize.min.css"  media="screen,projection"/>
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="dist/css/material-colors.css"/>
<link rel="stylesheet" type="text/css" href="dist/css/villa-cross.min.css"/>
<script src="dist/js/html5shiv.js"></script>
<script src="dist/js/html5shiv-printshiv.js"></script>
<script src="dist/js/classList.min.js"></script>
<![endif]-->

<style>

  .Grid {
    height: 100vh;
    margin: 0 auto;
    position: relative;
  }

</style>

<style>

  .Item {
    height: 100px;
    left: 0;
    margin: 16px;
    position: absolute;
    top: 0;
    width: 0;
  }

  .Item-inner {
    background-color: #ffffff;
    height: 100%;
    width: 100%;
  }

</style>

<body>

<div class="fixed-action-btn user-unselect">
  <a class="btn-floating btn-large red" onclick="grid.addItem();">
    <i class="large material-icons">add</i>
  </a>
</div>

<script type="text/javascript" src="dist/js/materialize.js"></script>
<script>

  M.AutoInit(document.body);

</script>
<main id="appGrid" class="Grid red"></main>

<script>

  class Grid {

    constructor (element) {

      this.element = element;

      this.itemList = [];

      // id manager
      this.itemCount = 0;

      this.defaultItemWidth = 240;
      this.defaultRowLength = 3;

      this.resize();

    }

    addItem() {

      const item = new Item(this, this.itemCount++);

      this.element.appendChild(item.element);
      this.itemList.push(item);

      this.reOder();

    }

    resize() {

      const gridElementWidth = ( this.defaultItemWidth * this.defaultRowLength ) + ( ( this.defaultRowLength + 1 ) * 16 );
      this.element.style.width = gridElementWidth + 'px';

    }

    reOder() {

      // const reverseItemList = this.itemList.slice().reverse();

      this.resize();

      let width = 0;

      for (let i = 0; i < this.itemList.length; i++) {

        const item = this.itemList[i];

        item.resize(this.defaultItemWidth, 0);
        item.translate(width, 0);

        width += item.element.offsetWidth + 16;

        const position = Grid.getItemPosition(i, this.defaultRowLength);
        console.log(position);

      }

    }

    static getItemPosition(i, rowLength) {

      return {
        x: Grid.getXPosition(i, rowLength),
        y: Grid.getYPosition(i, rowLength)
      }

    }

    // item position on row
    static getXPosition(i, rowLength) {

      return parseInt(Math.abs( i - ( ( i / rowLength ) * rowLength ) ).toString(), 10);

    }

    // item position on column
    static getYPosition(i, rowLength) {

      return parseInt(Math.abs( i / rowLength ).toString(), 10);

    }

  }

</script>

<script>

  class Item {

    constructor (gridParent, id) {

      this.gridParent = gridParent;
      this.id = '-item' + id;

      this.build();

    }

    build() {

      this.element = document.createElement('div');
      this.element.className = 'Item';
      this.element.dataset.id = this.id;

      this.element.inner = document.createElement('div');
      this.element.inner.className = 'Item-inner';
      this.element.inner.innerHTML = this.id;
      this.element.appendChild(this.element.inner);

    }

    resize(width, height) {

      this.element.style.width = width + 'px';

    }

    translate(tx, ty) {

      tx = tx + 'px';
      ty = ty + 'px';

      this.element.style.transform = 'translate3d(' + tx + ', ' + ty + ',0)';

    }

  }

</script>

<script>

  const grid = new Grid(document.getElementById('appGrid'));

</script>

</body>

</html>